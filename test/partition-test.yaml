apiVersion: faasshare.tum/v1
kind: SharePod
metadata:
  name: test-resnet
  namespace: faas-share-fn 
  labels:
    "com.openfaas.scale.max": "4"
    "com.openfaas.scale.min": "4"
    "faas_function": "resnet"
  annotations:
    "kubeshare/gpu_request": "0.5"
    "kubeshare/gpu_limit": "1.0"
    "kubeshare/gpu_partition": "50"
    "kubeshare/gpu_mem": "2073741824"
spec:
  replicas: 4
  podSpec:
    terminationGracePeriodSeconds: 1
    containers:
      - name: resnet
        image: yukiozhu/mlperf-faas-resnet:pytorch-t1
        env:
          - name: CUDA_MPS_ACTIVE_THREAD_PERCENTAGE
            value: "6"
        ports:
          - containerPort: 8080
        readinessProbe:
          tcpSocket:
            port: 5000
          initialDelaySeconds: 5
          periodSeconds: 10
        volumeMounts:
          - name: "model-volume"
            mountPath: "/models/"
    volumes:
      - name: "model-volume"
        hostPath:
          path: "/models/"


